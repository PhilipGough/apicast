daemon off;

events {
    worker_connections 1024;
}

stream {
    lua_code_cache on;

    resolver local=on;

    # define a TCP server listening on the port 1234:
    server {
        listen $TEST_NGINX_HTTP_PROXY_PORT;

        lua_check_client_abort on;

        content_by_lua_block { require('proxy').content() }
        preread_by_lua_block { require('proxy').preread() }
        log_by_lua_block { require('proxy').log() }
    }
}
